We need to fix the PriceCharting integration.

The goal is to fill in missing cards in our existing Marvel Card Vault database, using the PriceCharting API properly.

We now understand that PriceCharting treats each individual card as a â€œproductâ€.
We will use the /api/products?platform=trading-card endpoint, and parse the product names to match them to our sets and cards.

Here is the exact strategy you need to implement:

ğŸ¯ Strategy:
âœ… Call the PriceCharting API:

nginx
Copy
Edit
GET https://www.pricecharting.com/api/products?platform=trading-card&prettyprint
(with the API key in the request)

âœ… Iterate through the returned products[].

âœ… For each product:

Parse product.name into:

setName â†’ the name of the set

cardNumber â†’ the number of the card (if present in the name)

cardName â†’ the character name

Use fuzzy matching to find the closest card_sets.name in our DB.

If it matches a set â†’ proceed.

If itâ€™s a close variant (like XYZ SP) â†’ assign it to that set.

If itâ€™s clearly a distinct variant (like XYZ Orange) â†’ create a new subset with mainSetId = null.

âœ… Check if a card with this setName + cardNumber already exists in our DB:

If yes â†’ skip.

If no â†’ insert a new card with:

name = parsed cardName

cardNumber = parsed cardNumber

frontImageUrl = product.image_url

price = product.loose_price

setId = matched card_set.id

âœ… Do not touch or update existing cards â€” only insert missing ones.

ğŸ“ Notes:
Store pricecharting_product_id in the DB for traceability.

Leave mainSetId as null if creating a new subset.

Do not attempt to fetch or process images via Cloudinary at this step.

Do not process cards without a clear setName.

ğŸ§ª Implementation:
Write this as a standalone script, named:

arduino
Copy
Edit
scripts/import-pricecharting-products.ts
It should log:

How many products were processed.

How many sets were matched.

How many new cards were inserted.

How many were skipped as duplicates.

ğŸš¦ Questions you should ask me before proceeding if unclear:
What rules to use when extracting setName and cardNumber from product.name?

What threshold defines a â€œcloseâ€ set name match vs. â€œdifferentâ€?

How to handle cards missing cardNumber?

How to handle mainSetId if multiple possible matches?

Do not assume anything beyond whatâ€™s above â€” ask me before guessing.